name: Build and Test

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    build:
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest, macos-latest, windows-latest]
                go-version: ["1.21", "1.22"]

        steps:
            - uses: actions/checkout@v4

            - name: Set up Go
              uses: actions/setup-go@v4
              with:
                  go-version: ${{ matrix.go-version }}

            - name: Build
              run: go build -v ./...

            - name: Test
              run: go test -v -coverprofile=coverage.out ./...

            - name: Coverage Report
              run: go tool cover -func=coverage.out

            - name: Run go vet
              run: go vet ./...

            - name: Install staticcheck
              run: go install honnef.co/go/tools/cmd/staticcheck@latest

            - name: Run staticcheck
              run: staticcheck ./...
